#+TITLE: John's emacs config

* My settings
#+BEGIN_SRC emacs-lisp
  (defvar want-evil nil
    "evil-mode on startup.")

  (defvar want-lispy t
    "lispy in lisp-modes")

  (defvar sexp-modes '(clojure-mode
                       clojurescript-mode
                       emacs-lisp-mode
                       lisp-interaction-mode
                       lisp-mode)
    "Editing modes that use sexp/lisp syntax")
#+END_SRC

* Basics
** Configure default behavior
#+BEGIN_SRC emacs-lisp
  ;; ahhhhhhhhhhhhh
  (setq ring-bell-function 'ignore)

  ;; backups
  (setq backup-directory-alist '(("." . "~/.emacs.d/backup"))
        backup-by-copying t    ; Don't delink hardlinks
        version-control t      ; Use version numbers on backups
        delete-old-versions t  ; Automatically delete excess backups
        kept-new-versions 20   ; how many of the newest versions to keep
        kept-old-versions 5    ; and how many of the old
        )

  ;; colors!
  (load-theme 'wombat)

  ;; Shrink fringes to 1 pixel.
  (fringe-mode 1)

  ;; font size
  (set-face-attribute 'default nil :height 120)

  ;; flat modeline
  (set-face-attribute 'mode-line nil :box nil)
  (set-face-attribute 'mode-line-inactive nil :box nil)

  ;; turn off stupid bars (in order of greatest annoyance)
  (tool-bar-mode -1)
  (menu-bar-mode -1)
  (scroll-bar-mode -1)

  ;; truncate minibuffer display
  (setq message-truncate-lines t)

  ;; modeline time
  ;; (setq display-time-default-load-average nil)
  ;; (setq display-time-format "%b %d %Y %H:%M")
  ;; (display-time-mode 1)
  ;; (display-battery-mode 1)

  ;; line numbers
  (add-hook 
    'prog-mode-hook 
    (lambda ()
      (display-line-numbers-mode)
      (setq display-line-numbers 'relative)))

  ;; line flow
  (setq-default fill-column 80)

  ;; narrow?
  (put 'narrow-to-region 'disabled nil)

  ;; self-care
  (setq inhibit-startup-screen t)
  (setq inhibit-startup-echo-area-message "This aint your dad's spacemacs")
  (setq initial-scratch-message ";; 頑張って!\n\n")

  ;; add user modules to load path
  (add-to-list 'load-path (expand-file-name "vendor"
                                            user-emacs-directory))

  ;; org-mode
  (require 'org)
  (setq-default org-confirm-babel-evaluate nil)

  ;; enable package manager
  (require 'straight-init)
#+END_SRC

** Editor stuff
#+BEGIN_SRC emacs-lisp
  (use-package frames-only-mode
    :config (frames-only-mode 1))  

  (use-package which-key
    :config (which-key-mode 1))

  (use-package undo-tree
    :config (global-undo-tree-mode 1))

  (use-package ivy
    :config
    (ivy-mode 1))

  (use-package counsel
    :after (ivy)
    :config 
    (counsel-mode 1))

  (use-package swiper
    :after (ivy)
    :config
    (global-set-key [remap isearch-forward] 'swiper-isearch)
    (global-set-key [remap isearch-backward] 'swiper-isearch-backward))

  (setq ivy-initial-inputs-alist nil)

  (use-package company
    :config (global-company-mode 1))

  (use-package xah-fly-keys
    :config
    (xah-fly-keys-set-layout "qwerty")
    (xah-fly-keys 1))

  (use-package sunrise
    :straight (sunrise :type git
                       :host github
                       :repo "sunrise-commander/sunrise-commander"))
#+END_SRC

** Markup
#+BEGIN_SRC emacs-lisp
  (use-package yaml-mode
    :mode "\\.yml\\'")

  (use-package markdown-mode
    :mode "\\.md\\'"
    :config
    (setq-default markdown-hide-markup t
                  markdown-hide-urls t))
#+END_SRC

** Eshell
#+BEGIN_SRC emacs-lisp
  (require 'eshell)

  (defun eshell/clear ()
    "Actually clear eshell"
    (interactive)
    (let ((inhibit-read-only t))
      (erase-buffer)))
#+END_SRC

** Evil
#+BEGIN_SRC emacs-lisp
  (use-package evil
    :if want-evil
    :after undo-tree
    :init
    (setq evil-want-keybinding nil)
    (setq evil-want-integration t)
    :config (evil-mode 1))

  (use-package evil-surround
    :if want-evil
    :after evil
    :config (global-evil-surround-mode 1))

  (use-package evil-collection
    :if want-evil
    :after evil
    :config (evil-collection-init))

  (use-package evil-magit
    :if want-evil
    :after evil)
#+END_SRC

** PDF
#+BEGIN_SRC emacs-lisp
  (use-package pdf-tools
    :disabled
    :mode (("\\.pdf\\'" . pdf-tools))
    :config (pdf-loader-install))
#+END_SRC

** Innernet
#+BEGIN_SRC emacs-lisp
  (use-package w3m
    :disabled)

  (use-package web-search
    :init (setq web-search-default-provider "DuckDuckGo")
    :bind ("C-c w" . web-search))

#+END_SRC

** Helping hands
#+BEGIN_SRC emacs-lisp
  (defun from-userdir (path)
    "Expand relative PATH from `user-emacs-directory`"
    (expand-file-name path user-emacs-directory))

  (defun edit-user-config ()
    "Edit the main configuration file"
    (interactive)
    (find-file-other-frame user-config-source-file))

  (defun config-reinit ()
    "Reload init.el"
    (interactive)
    (load (from-userdir "init.el")))

  (defmacro make-alias (var &rest syms)
    "Alias all of SYMS to VAR"
    (append '(progn)
            (mapcar (lambda (s) (list 'defvaralias s var)) syms)))
#+END_SRC

** Keys
#+BEGIN_SRC emacs-lisp
  (bind-keys
    :map xah-fly-key-map
    ;; Ibuffer
    ([remap list-buffers] . ibuffer)

    ;; Font size
    ("C-=" . text-scale-increase)
    ("C--" . text-scale-decrease)
    ("C-+" . (lambda () (interactive) (text-scale-set 0)))

    ;; Config
    ("<f9>"  . config-reinit)
    ("<f12>" . edit-user-config))
#+END_SRC

* Programming
** General
#+BEGIN_SRC emacs-lisp
  (setq-default indent-tabs-mode nil
                tab-width 2)

  (make-alias 'tab-width 'standard-indent 
                         'sh-basic-offset)

  (use-package rainbow-delimiters
    :hook ((prog-mode . rainbow-delimiters-mode)))

  (use-package smartparens
    :hook ((prog-mode . smartparens-mode)
           (elisp-mode . smartparens-mode))
    :config (sp-use-smartparens-bindings))
#+END_SRC

** IDE things
#+BEGIN_SRC emacs-lisp
  (use-package flycheck
    :config (global-flycheck-mode 1))

  (use-package expand-region
    :bind ("C-." . 'er/expand-region))

  (use-package projectile)

  (use-package magit)

  (use-package direnv
    :config (direnv-mode))

  (use-package nix-mode
    :mode "\\.nix\\'")
#+END_SRC

** Lisp
#+BEGIN_SRC emacs-lisp
  (use-package cider
    :init
    (setq-default clojure-indent-style 'align-arguments)
    (setq org-babel-clojure-backend 'cider)
    (require 'ob-clojure))
#+END_SRC

** Javascript
#+BEGIN_SRC emacs-lisp
  (use-package rjsx-mode
    :mode (("\\.js\\'"  . rjsx-mode)
	         ("\\.ts\\'"  . rjsx-mode)
	         ("\\.tsx\\'" . rjsx-mode))
    :config (setq js2-strict-missing-semi-warning nil))

  (use-package tide
    :after (rjsx-mode flycheck)
    :hook ((rjsx-mode . tide-setup)
	         (rjsx-mode . tide-hl-identifier-mode)))
#+END_SRC

** Snake
#+BEGIN_SRC emacs-lisp
  (setq python-indent-offset 2)

  (use-package pipenv
    :hook (python-mode . pipenv-mode)
    :init
    (setq
     pipenv-projectile-after-switch-function
     #'pipenv-projectile-after-switch-extended)) 
#+END_SRC


